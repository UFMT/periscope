<?xml version='1.0' encoding='utf-8' ?>  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"  
    xmlns:h="http://java.sun.com/jsf/html"  
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"  
    xmlns:p="http://primefaces.org/ui">  

<f:view contentType="text/html">  
    <h:head>  
  		<title>Periscope ESB admin</title>
  		<center>
  			<h1>Services in the ESB</h1>
  		</center>
    </h:head>  
      
    <h:body>  
    	
    	<h:form id="formServices">
    		<p:messages autoUpdate="true" />
	      <p:dataTable id="tblServices" value="#{serviceMB.services}" var="service"
	      	emptyMessage="there are no services registered" 
	      	paginator="true" paginatorAlwaysVisible="true"
			paginatorPosition="bottom" rows="10" filteredValue="#{serviceMB.filteredServices}">
	      
	      	<p:column headerText="service">
	      		<p:outputLabel value="#{service.name}"/>
	      	</p:column>
	      
	      	<p:column headerText="actions" style="width : 30%">
	      		<center>
		      		<p:commandButton value="edit" oncomplete="dlgInsertToken.show();" actionListener="#{serviceMB.operationIsEdit()}"
		      			update=":dialogEditService :dialogInsertToken">
		      			<f:setPropertyActionListener target="#{serviceMB.service}" value="#{service}" />
		      		</p:commandButton>
		      		<p:commandButton value="delete" oncomplete="dlgInsertToken.show();" actionListener="#{serviceMB.operationIsDelete()}"
		      			update=":dialogInsertToken">
		      			<f:setPropertyActionListener target="#{serviceMB.service}" value="#{service}" />
		      		</p:commandButton>
	      		</center>
	      	</p:column>
	      
	      </p:dataTable>
	      
	      <br />
	      <br />
	      <p:commandButton value="New register" actionListener="#{serviceMB.prepareNew()}" immediate="true"
	      	oncomplete="dlgNew.show();" update=":dialogNew"/>
	     </h:form>     
	     
	     <p:dialog id="dialogNew" widgetVar="dlgNew" modal="true" closable="false" resizable="false" appendToBody="true">
	     	<h:form>
	     	<h:panelGrid columns="3">
		     	<p:outputLabel value="lblServiceName" for="txtServiceName"/>
		     	<p:inputText value="#{serviceMB.service.name}" id="txtServiceName" required="true"
		     		requiredMessage="please inform the name of the service" validator="#{serviceMB.validateServiceName}"/>
		     	<p:message  for="txtServiceName" />
		     	
		     	<p:outputLabel value="lblPath" for="txtPath"/>
		     	<p:inputText value="#{serviceMB.service.realPath}" id="txtPath" required="true"
		     		requiredMessage="please inform the path to reach the service" />
		     	<p:message  for="txtPath"/>
	     	</h:panelGrid>
	     	<center>
	     		<p:commandButton value="Close" onclick="dlgNew.hide();" immediate="true"/>
	     		<p:commandButton value="Register" actionListener="#{serviceMB.saveNew()}" oncomplete="dlgNew.hide();" 
	     			update=":dialogShowToken"/>
	     			
	     				     	</center>
	     	</h:form>
	     </p:dialog>
	     
	     <p:dialog id="dialogShowToken" widgetVar="dlgShowToken" modal="true" closable="false" resizable="false" appendToBody="true"
	     >
		     <h:form>
		     	<p:outputLabel value="Please hold your token to manage your service!"/>
		     	<br />
		     	<p:outputLabel value="your token is: #{serviceMB.service.token}"/>
		     	<br />
		     	<center>
		     		<p:commandButton value="close" onclick="dlgShowToken.hide();" immediate="true" update=":formServices"/>
		     	</center>
		     </h:form>
	     </p:dialog>
	     
	     <p:dialog id="dialogInsertToken" widgetVar="dlgInsertToken" modal="true" closable="false" resizable="false" appendToBody="true">
		     <h:form>
		     		<p:outputLabel value="Please insert the token to proceed"/>
		     		<br />
		     		<p:inputText value="#{serviceMB.token}" validator="#{serviceMB.validateToken}"/>
		     	<center>
		     		<p:commandButton value="close" onclick="dlgInsertToken.hide();" immediate="true" update=":formServices"/>
		     		<p:commandButton value="confirm" onclick="dlgInsertToken.hide();" update=":formServices :dialogDeleteService" 
		     			actionListener="#{serviceMB.processInsertTokenDialog()}"/>
		     	</center>
		     </h:form>
	     </p:dialog>
	     
	     <p:dialog id="dialogDeleteService" widgetVar="dlgDeleteService" modal="true" closable="false" resizable="false" appendToBody="true">
		     <h:form id="formDeleteService">
		     	<center>
		     		<p:outputLabel value="Confirm deleting the service below?"/>
		     	</center>
		     	<h:panelGrid columns="2">
		     		<p:outputLabel value="service name:"/>
		     		<p:outputLabel value="#{serviceMB.service.name}"/>
		     		
		     		<p:outputLabel value="path:"/>
		     		<p:outputLabel value="#{serviceMB.service.realPath}"/>
		     	</h:panelGrid>
		     	<br />
		     	<br />
		     	<center>
		     		<p:commandButton value="close" onclick="dlgDeleteService.hide();" immediate="true" update=":formServices"/>
		     		<p:commandButton value="confirm" onclick="dlgDeleteService.hide();" update=":formServices" actionListener="#{serviceMB.deleteConfirmed()}"/>
		     	</center>
		     </h:form>
	     </p:dialog>
	     
	     <p:dialog id="dialogEditService" widgetVar="dlgEditService" modal="true" closable="false" resizable="false" appendToBody="true">
		     <h:form id="formEditService">
		     	<h:panelGrid columns="3">
		     		<p:outputLabel value="service name:"/>
		     		<p:inputText value="#{serviceMB.service.name}" required="true" requiredMessage="please inform the name of the service"
		     			validator="#{serviceMB.validateServiceName}" id="txtServiceName"/>
		     		<p:message for="txtServiceName"/>
		     		
		     		<p:outputLabel value="lblPath" for="txtPath"/>
		     		<p:inputText value="#{serviceMB.service.realPath}" id="txtPath" required="true"
		     			requiredMessage="please inform the path to reach the service" />
		     		<p:message  for="txtPath"/>
		     	</h:panelGrid>
		     	<br />
		     	<br />
		     	<center>
		     		<p:commandButton value="close" onclick="dlgDeleteEdit.hide();" immediate="true" update=":formServices"/>
		     		<p:commandButton value="confirm" onclick="dlgEditService.hide();" update=":formServices" actionListener="#{serviceMB.editConfirmed()}"/>
		     	</center>
		     </h:form>
	     </p:dialog>
          
    </h:body>
    
</f:view>  
</html>  